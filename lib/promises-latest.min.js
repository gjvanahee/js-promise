/*! promises v0.1.1 2014-02-04 15:32:56 Licence MIT */
var Promise=function(){"use strict";var a=function(a,b){return!!Object.prototype.toString.call(a).match(new RegExp(b))},b=function(b){return function(){for(var c=b.chain.shift();c;){try{b.state===i.FULFILLED&&a(c.fulfilled,"Function")?f(c.promise,c.fulfilled.call(void 0,b.value_or_reason)):b.state===i.REJECTED&&a(c.rejected,"Function")?f(c.promise,c.rejected.call(void 0,b.value_or_reason)):e(c.promise,b.state,b.value_or_reason)}catch(d){e(c.promise,i.REJECTED,d)}c=b.chain.shift()}}},c=function(a){return function(b){e(a,i.FULFILLED,b)}},d=function(a){return function(b){e(a,i.REJECTED,b)}},e=function(a,b,c){b!==i.PENDING&&a.state===i.PENDING&&(a.state=b,a.value_or_reason=c,g(a))},f=function(b,g){if(b===g&&e(b,i.REJECTED,new TypeError("Function return value is same as promise linked.")),a(g,"Object")&&a(g.chain,"Object")&&a(g.then,"Function"))g.then(c(b),d(b));else if(a(g,"Object|Function")){var h=!0;try{var j=g.then;a(j,"Function")?j.call(g,function(a){h&&(h=!1,f(b,a))},function(a){h&&(h=!1,e(b,i.REJECTED,a))}):e(b,i.FULFILLED,g)}catch(k){h&&e(b,i.REJECTED,k)}}else e(b,i.FULFILLED,g)},g=function(a){a.state!==i.PENDING&&h(b(a),0)},h=process&&process.nextTick?process.nextTick:setTimeout,i={PENDING:0,FULFILLED:1,REJECTED:-1},j=function(a){this.chain=[],this.state=i.PENDING,this.value_or_reason=void 0;try{a.call(void 0,c(this),d(this))}catch(b){e(this,i.REJECTED,b)}};return Promise=function(a){j.call(this,a)},Promise.prototype.then=function(a,b){var c={promise:new Promise(function(){}),fulfilled:a,rejected:b};return this.chain.push(c),g(this),c.promise},Promise}();"undefined"!=typeof module&&(module.exports.Promise=Promise);