/*! promises v0.1.1 2014-01-30 12:26:05 Licence MIT */
var Promise=function(){"use strict";var a=function(a,b){return!!Object.prototype.toString.call(a).match(new RegExp(b))},b=function(b,c){return function(){try{b.state===h.State.FULFILLED&&a(c.fulfilled,"Function")?f(c.promise,c.fulfilled.call(void 0,b.value_or_reason)):b.state===h.State.REJECTED&&a(c.rejected,"Function")?f(c.promise,c.rejected.call(void 0,b.value_or_reason)):e(c.promise,b.state,b.value_or_reason)}catch(g){d(c.promise)(g)}}},c=function(a){return function(b){e(a,h.State.FULFILLED,b)}},d=function(a){return function(b){e(a,h.State.REJECTED,b)}},e=function(a,b,c){b!==h.State.PENDING&&a.state===h.State.PENDING&&(a.state=b,a.value_or_reason=c,g(a))},f=function(b,g){if(b===g&&e(b,h.State.REJECTED,new TypeError("Function return value is same as promise linked.")),a(g,"Object")&&a(g.chain,"Object")&&a(g.then,"Function"))g.then(c(b),d(b));else if(a(g,"Object|Function")){var i=!0;try{var j=g.then;a(j,"Function")?j.call(g,function(a){i&&(i=!1,f(b,a))},function(a){i&&(i=!1,e(b,h.State.REJECTED,a))}):e(b,h.State.FULFILLED,g)}catch(k){i&&e(b,h.State.REJECTED,k)}}else e(b,h.State.FULFILLED,g)},g=function(a){if(a.state!==h.State.PENDING)for(var c=a.chain.shift();c;)setTimeout(b(a,c),0),c=a.chain.shift()},h=function(a){this.chain=[],this.state=h.State.PENDING,this.value_or_reason=void 0;try{a.call(void 0,c(this),d(this))}catch(b){e(this,h.State.REJECTED,b)}};return h.State={PENDING:0,FULFILLED:1,REJECTED:-1},h.prototype.then=function(a,b){var c={promise:new h(function(){}),fulfilled:a,rejected:b};return this.chain.push(c),g(this),c.promise},h}();"undefined"!=typeof exports&&(exports.Promise=Promise);